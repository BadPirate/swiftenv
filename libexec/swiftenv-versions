#!/usr/bin/env bash
# List all Swift versions available to swiftenv

set -e

CURRENT_VERSION=$(swiftenv-version-name || true)

print_version() {
  if [ "$1" == "$CURRENT_VERSION" ]; then
    echo "* $1 (set by $(swiftenv-version-origin))"
  else
    echo "  $1"
  fi
}

VERSIONS_DIR="$SWIFTENV_ROOT/versions"

if [ "$CURRENT_VERSION" == "system" ]; then
  echo "* system"
fi

TOOLCHAIN_DIR="/Library/Developer/Toolchains"
if [ -d "$TOOLCHAIN_DIR" ]; then
  for path in "$TOOLCHAIN_DIR"/*; do
    if [[ "$path" == *".xctoolchain" ]] && [ -d "$path" ]; then
      version="$(basename ${path##*/} .xctoolchain)"
      print_version "$version"
    fi
  done
fi

for path in "$VERSIONS_DIR"/*; do
  if [ -d "$path" ]; then
    print_version "${path##*/}"
  fi
done
